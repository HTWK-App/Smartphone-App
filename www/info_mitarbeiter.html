<div id="staff_page" data-role="page" data-theme='b'>
	<div data-role="panel" id="menue_info_mitarbeiter" data-theme="a" data-display="push">
		<ul data-role="listview">
			<li data-role="list-divider" role="heading">Hauptmenü</li>
			<li data-icon="fire"><a href="index.html" >Startseite</a></li>
			<li data-icon="fire"><a href="news.html" >News</a></li>
			<li data-icon="trophy"><a href="stundenplan.html" >Stundenplan</a></li>
			<li data-icon="trophy"><a href="mensa.html" >Mensa</a></li>
			<li data-icon="trophy"><a href="postfach.html" >Postfach</a></li>
			<li data-icon="trophy"><a href="qis.html" >QIS</a></li>
			<li data-icon="trophy"><a href="sport.html" >Hochschulsport</a></li>
			
		</ul>
		<!--<div data-role="collapsible"><h4>Info-Center</h4> -->
		<ul data-role="listview">
			<li data-role="list-divider" role="heading">Info-Center</li>
			<li data-icon="trophy"><a href="info_allgemein.html" >Allgemein</a></li>
			<li data-icon="trophy"><a href="info_mitarbeiter.html" >Mitarbeiter</a></li>
			<li data-icon="trophy"><a href="info_gebaeudeplan.html" >Gebäudeplan</a></li>
			<li data-icon="trophy"><a href="info_wlan.html" >WLAN-Konfiguration</a></li>
		</ul>
		<!--</div> -->
		<ul data-role="listview">
			<li data-role="list-divider" role="heading">Tools</li>
			<li data-icon="trophy"><a href="tools_leeren-raum.html" >Leeren Raum finden</a></li>
			<li data-icon="trophy"><a href="tools_buch.html" >Buchausleihe</a></li>
		</ul>
		<ul data-role="listview">
			<li data-role="list-divider" role="heading">Einstellungen</li>
			<li data-icon="trophy"><a href="einstellungen_htwk-app.html" >HTWK-App</a></li>
		</ul>
	</div>
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
		<a href="#menue_info_mitarbeiter" data-role='button' role="button" data-iconpos='left' data-inline='true'><i class="icon-ellipsis-vertical"></i>&nbsp;</a>
		<h1>&nbsp;HTWK App</h1>
	</div>
	<div data-role="content">
		<br/>
		<ul id="staff_content_list" data-role="listview" data-filter-reveal="true" data-filter-placeholder="Suche Mitarbeiter" data-filter="true" data-inset="true">
			
		</ul>
	</div>
<script>

	$( "#staff_page" )
		.on("pagecreate", initStaffView)
		.on("pageshow", function() {
			if(!GLOBAL.INIT.staff) loadingIn();
			$("#btn_refresh")
				.off()
				.on("click", initStaffView);
			//$("#staffdetails").detach();
		 });

	function initStaffView() {
		loadingIn();
		$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.staff)
		 .done(function(data, status, jqXHR) {
			 fillStaffList(data);
			 loadingOut();
			 GLOBAL.INIT.staff = true;
		  });
		// TODO fail
	};
	
	function fillStaffList(data) {
		var emp, name;
		var lis = "";
		
		if(!isEmpty(data))
		{
			for(var k in data)
			{
				emp = data[k];
				name = emp.name.split(", ");
				
				lis += 	'<li data-cuid="'+emp.cuid+'">'+
							'<a href="#staff_'+emp.cuid+'" class="staff">'+
							'<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.staff+emp.cuid+'/thumb" style="margin:8px 0 0 8px;">'+
								name[1]+' '+name[0]+', '+emp.degree+
								'<p>'+emp.faculty+'</p>'+
						'</a></li>';
			}
			
			$( "#staff_content_list" )
				.off()
				.empty()
				.append(lis)
				.on("click", "a.staff", loadStaffDetails)
				.listview("refresh")
				.trigger("updatelayout");
			
			$( "body" )
				.find("div.staffdetails")
				.remove();
		}
	};

	function loadStaffDetails(e) {
		var id = $(e.target).parents("li").first().data("cuid");
		
		if($("#staff_"+id).length>0) {
			$.mobile.initializePage();
			$.mobile.changePage("#staff_"+id);
			return;
		}
		
		loadingIn();
		
		$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.staff+id)
		 .done(function(data, status, jqXHR) {
			var name = data.name.split(", ");
			var div = 		'<div id="staff_'+id+'" data-role="page" data-theme="b" data-subpage="true" data-title="Mitarbeiter">'+
								'<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="b">'+
									'<a href="#" data-rel="back" data-role="button" data-transition="slide" data-direction="reverse"><i class="icon-angle-left"></i></a>'+
									'<h1>&nbsp;HTWK App</h1>'+
								'</div>'+
								'<div data-role="content">'+
								'	<div class="inset">'+
								'		<h1>'+data.degree+' '+name[1]+' '+name[0]+'</h1>'+
								'		<ul data-nativedroid-plugin="cards">'+
								'			<li data-cards-type="text">'+
								'				<h1>Info</h2>'+
								'				<p>'+
								'					<strong>Grad:</strong> '+data.degree+' <br/>'+
								'					<strong>Bereich:</strong> '+data.faculty+' <br/>'+
								'					<strong>Objekt:</strong> '+data.location+' <br/><br/>'+
								'					<p>'+data.description+'</p>'+
								'				</p>'+
								'			</li>'+
								'			<li data-cards-type="text">'+
								'				<!--<h2>Info</h2> BILD -->'+
								'				<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.staff+id+'/pic"/>'+
								'			</li>'+
								'			<li data-cards-type="text">'+
								'				<h1>Kontakt</h2>'+
								'				<p>'+
								'					<strong>E-Mail:</strong> <a href="mailto:'+data.email+'">'+data.email+'</a><br/>'+
								'					<strong>Telefon:</strong> <a href="tel:'+data.telephone+'">'+data.telephone+'</a> <br/>'+
								'					<strong>Fax:</strong> '+data.telefax+' <br/>'+
								'				</p>'+
								'			</li>'+
								'			<li data-cards-type="text">'+
								'				<h1>Links</h2>'+
								'				<p>'+
								'					<strong><a href="'+data.detailLink+'" class="external">Details zur Person</a></strong> '+
								'					<strong><a href="'+data.vcardLink+'">V-Card</a></strong>'+
								'				</p>'+
								'			</li>'+
								'		</ul>'+
								'	</div>'+
								'</div>';
			
			
			
			
			
			
			
			
			$( "body" )
				.append(div)
				.trigger("create");
			
			$.mobile.initializePage();
			$.mobile.changePage("#staff_"+id);
			
			loadingOut();
		});
	};
</script>
</div>
