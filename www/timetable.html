<div id="timetable_page" data-role="page" data-theme='b' data-dom-cache="true">
	<div data-role="panel" id="menue_stundenplan" data-theme="a" data-display="push">
		<ul data-role="listview">
			<li data-role="list-divider">Hauptmenü</li>
			<li data-icon="fire"><a href="index.html" >Startseite</a></li>
			<li data-icon="fire"><a href="news.html" >News</a></li>
			<li data-icon="trophy"><a href="timetable.html" >Stundenplan</a></li>
			<li data-icon="trophy"><a href="canteen.html" >Mensa</a></li>
			<li data-icon="trophy"><a href="mail.html" >Postfach</a></li>
			<li data-icon="trophy"><a href="qis.html" >QIS</a></li>
			<li data-icon="trophy"><a href="sport.html" >Hochschulsport</a></li>
			
		</ul>
		<!--<div data-role="collapsible"><h4>Info-Center</h4> -->
		<ul data-role="listview">
			<li data-role="list-divider">Info-Center</li>
			<li data-icon="trophy"><a href="info_general.html" >Allgemein</a></li>
			<li data-icon="trophy"><a href="info_staff.html" >Mitarbeiter</a></li>
			<li data-icon="trophy"><a href="info_buildings.html" >Gebäudeplan</a></li>
			<li data-icon="trophy"><a href="info_wlan.html" >WLAN-Konfiguration</a></li>
		</ul>
		<!--</div> -->
		<ul data-role="listview">
			<li data-role="list-divider">Tools</li>
			<li data-icon="trophy"><a href="room_search.html" >Leeren Raum finden</a></li>
			
		</ul>
		<ul data-role="listview">
			<li data-role="list-divider">Einstellungen</li>
			<li data-icon="trophy"><a href="settings.html" >HTWK-App</a></li>
		</ul>
	</div>
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
		<a href="#menue_stundenplan" data-role='button' role="button" data-iconpos='left' data-inline='true'><i class="icon-ellipsis-vertical"></i>&nbsp;</a>
		<h1>&nbsp;HTWK App</h1>
	</div>
	<div data-position="fixed" data-role="footer" data-theme='b'> <!--data-tap-toggle="true" setzen falls gewünscht--> 
		<div class="center">
			<a data-role="button" href="#" id="extendTimetable">Kalender erweitern...</a>
		</div>
	</div>
	<div data-role="content">   
		<div class="inset">
			<h1 id="actualWeek">Woche wird geladen</h1>
			<br/>
			<style type="text/css">
				.tg  {
					border-collapse:collapse;
					border-spacing:0;
					width:100%
				}
				table.tg td{
					padding:0px;
				}
				table.tg tr td.full-hour:first-child{
					width:50px;
				}
				table.tg tr th:first-child{
					width:50px;
				}
				table.tg th.weekdays{
					width:13%;
				}
				table.tg tr {
					height:30px;
				}
				table.tg tr.full-hour td {
					border-top:1px solid black;
					border-left:1px solid black;
				}

				table.tg tr.half-hour td{
					border-top:1px dotted #333333;
					border-left:1px solid black;
				}
				table.tg tr.full-hour td:first-child{
					border-left:0px;
					border-right:1px solid black;
					text-align:center;
				}
				table.tg tr.head th{
					border-collapse:separate;
					border-spacing:0px;
					border-top:1px solid black;
					border-left:1px solid black;
				}
				table.tg tr.head th.top-left-no-borders {
					border:0px;
				}
				table.tg tr th:last-child, table.tg tr td:last-child{
					border-right:1px solid black;
				}
				table.tg tr:last-child{
					border-bottom:1px solid black;
				}
				table.tg td span {
					font-size:0.8em;
					padding:0px;
					margin-right:7%;
					background-color:black;
					color:white;
					width:85%;
					height:100%;
					line-height:29px;
					float:right;
					display:block;
					overflow:auto
				}
				table.tg td span.start{
					-moz-border-radius: 5px 5px 0px 0px;
					border-radius: 5px 5px 0px 0px;
				}
				table.tg td span.middle{

				}
				table.tg td span.end{
					-moz-border-radius: 0px 0px 5px 5px;
					border-radius: 0px 0px 5px 5px;
				}
			</style>
			<select id="timetable_day_select" name="timetable_select" data-native-menu="true">
				<option selected="selected" data-day="1" value="">Montag</option>
				<option value="" data-day="2">Dienstag</option>
				<option value="" data-day="3">Mittwoch</option>
				<option value="" data-day="4">Donnerstag</option>
				<option value="" data-day="5">Freitag</option>
				<option value="" data-day="6">Samstag</option>
				<option value="" data-day="7">Sonntag</option>
			</select>
			<br/>
		</div>
		<div id="timetable_day" data-week="-1">
			<table class="tg">
			  <tr class="data full-hour">
				<td rowspan="2">07.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ><span class="start"><span>Termin start</span></span></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">08.00<br></td>
				<td ><span class="end"><span>Termin end</span></span></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">09.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">10.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">11.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td  rowspan="2">12.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td  rowspan="2">13.00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td  rowspan="2">14:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">15:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">16:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">17:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">18:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">19:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">20:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">21:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td ></td>
			  </tr>
			  <tr class="data full-hour">
				<td rowspan="2">22:00</td>
				<td ></td>
			  </tr>
			  <tr class="data half-hour">
				<td></td>
			  </tr>
			</table>
		</div>
	</div>
	<div id="timetableDialog" data-role="popup" data-dismissible="false" data-theme="b" data-overlyaTheme="b" data-transition="pop">
    		<div id="timetableDialogHeader" data-role="header" data-theme="b">
   	 	</div>
   	 	<div id="timetableDialogContent" data-role="content" data-theme='b' class="inset">
   	 	</div>
	</div>

	<script>		
	/*TODO
	 * Add function do delete timetable, when semester has changed (+ inform/request user)
	 * View of Timetable isn't the best
	*/
		$( "#timetable_page" )
			.on("pagecreate", initTimetableView)
			.on("pageshow", function() {
				if(!GLOBAL.INIT.timetable) loadingIn();
    				$("#btn_refresh")
					.off()
					.on("click", function() {
						$("#timetable_week_select").change(); 
					 });
				if(CONFIG.TIMETABLE.faculty.length == 0) showConfigDialog();
			 })
			.on("click", "#timetable_nav a", function(e) {
				$("#timetable_days table")
					.find("tbody")
					.hide().end()
					.find("tbody:jqmData(day='"+$(e.target).jqmData("day")+"')")
					.show();
			 })
			.on("swipeleft", "#timetable_days tbody", function() {
					var o = $(this);	
					
					if(o.index()<5)
					{	
						$("#timetable_nav a").eq(o.index()).not(".ui-disabled").click();
					}
			 })
			.on("swiperight", "#timetable_days tbody", function() {
					var o = $(this);	
					
					if(o.index()>1)
					{
						$("#timetable_nav a").eq(o.index()-2).not(".ui-disabled").click();
					}
			 });
			
		/*$( "#timetable_week_select" )//TODO
			.on("change", function() {
				$("#timetable_days table tbody").empty();
				fillTimetable();
			 });*/
		$("#extendTimetable")
			.on("click", showConfigDialog);

		/*********************************************************************************************************************
		  * This Area is used for Timetable Configuration Dialogs
		*/

		var popupOpen = false;

		/**
		 * Get a Popup with a Heading and a Description
		 * 
		 * @param String heading ... Heading of the Popup
		 * @param String description ... Text to display in the Popup
		 * @param Optional String btn_text ... If set, another button with btn_text as text will be displayd
		 * @param Optional Function func ... Callbackfunction for optional button
		 * 
		 * @return jQueryMobile Popup
		 */
		function fillPopup(heading, description, btn_text, func){
			$("#timetableDialogHeader").empty().append('<h3 style="padding: 5% 0 0 10%;">'+heading+'</h3>'); //TODO renew design
			$("#timetableDialogContent").empty().append('<p>'+description+'</p>');
			$("#timetableDialogContent").append('<a id="timetableDialogAbort" href="#" data-role="button" data-icon="back" data-mini="true" data-rel="back" data-inline="true" class="ui-corner-all ui-shadow">Abbrechen</a>');

			if(!isEmpty(btn_text)){
				$("#timetableDialogContent").append('<a id="timetableDialogSave" href="#" data-role="button" data-icon="check" data-mini="true" data-rel="back" data-inline="true" class="ui-corner-all ui-shadow">'+btn_text+'</a>');
			}
			$.mobile.activePage.trigger("create");
			$("#timetableDialog")
				.popup().off()
				.on("popupafteropen", function() {popupOpen = true;})
				.on("popupafterclose", function() {
					popupOpen = false;
			 	 });
			$("#timetableDialogAbort").off().on("click", abortSetup);
			$("#timetableDialogSave").off().on("click", func);
		}

		/**
		 * Aborts the displayed Dialog and resets configurations (if not completed)
		 * 
		 * @param Event e ... Click-Event of Link
		 */
		function abortSetup(e) {
			if(!isEmpty(e)){
				$("#timetableDialog").popup("close")
			}
			CONFIG.TIMETABLE.temporary= [];
//			if(CONFIG.TIMETABLE.faculty.length != 0) $("#timetable_week_select").change();//TODO
		};

		/**
		 * Opens the given Popup whenever another Popup is closed
		 * 
		 * @param JQueryMobile Popub popUp ... Popup to open
		 */
		function open(popUp){
			if(popupOpen == true){
				setTimeout(function(){open(popUp);}, 50);
				return;
			}
			loadingOut();
			$("#timetableDialog").popup("open");
		}

		function noContent(text){
			loadingOut();
			loadingIn(text,true);
			setTimeout(loadingOut, 3000);
			CONFIG.TIMETABLE.temporary= [];
		}

		/**
		 * Starts Configuration Dialog for Timetable.
		 * 
		 * @param Optional Event e ... Click-Event of Link
		 */
		function showConfigDialog(e) {	
			if(!isEmpty(e))
				abortSetup(e); //Not the right name, but the right functionality!
			loadingIn();
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+"/cal")
			 .done(function (data, status, jqXHR) {
				if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR, abortSetup); return;}
				CONFIG.TIMETABLE.semester = data.semester;
				$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+data.semester)
		 		 .done(function (data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR, abortSetup); return;}

					var ul = '<ul id="chooseCourse" data-func="course" data-role="listview" data-inset="true" data-filter="true" data-filter-reveal="true" data-filter-placeholder="Suche Studiengang...">';
					
					for(var k in data) {
						for(var s in data[k].courses) {
							var course = data[k].courses[s];
							ul += '<li class="ui-screen-hidden" data-course="'+course.id+'" data-faculty="'+data[k].id+'"><a href="#">'+course.name+'</a></li>';
						}
					}

					ul += '</ul>';
					ul = $(ul).on("click", "a", facultyChosen);

					fillPopup("Einrichtung", "Bitte wählen Sie ihren Studiengang aus!");
					$("#timetableDialogAbort").before(ul);
					$("#timetableDialog").trigger("create");
					$("#timetableDialog").popup();
					
					setTimeout(function(){open($("#timetableDialog"));}, 50);
					
					loadingOut();
				})
				.fail(ajaxErrorHandler);
			})
			.fail(ajaxErrorHandler);
		};

		/**
		 * Called by Configuration Dialog. At this point, a faculty was chosen.
		 * 
		 * @param Event e ... Click-Event of Link
		 */
		function facultyChosen(e) {
			var li = $(e.target).parent("li");
			var id = li.jqmData("course");
			var fac = li.jqmData("faculty");
			
			loadingIn();
			CONFIG.TIMETABLE.temporary.push({"id": id, "groups": []});
			
			li.closest("div:jqmData(role='popup')").popup("close");
			
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+CONFIG.TIMETABLE.semester)
		 		.done(function (data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR, abortSetup); return;}

					var empty = true;
					var lis = '<ul data-role="listview">';
					
					for(var k in data) {
						for(var s in data[k].courses) {
							var course = data[k].courses[s];
							
							if(course.id === id) {
								for(var p in course.semGroups) {
									lis += '<li><a href="#">'+course.semGroups[p]+'</a></li>';
									empty = false;
								}
							}
						}
					}
					
					lis += '</ul>';
					lis = $(lis).on("click", "a", courseChosen); 
					
					fillPopup("Einrichtung", "Bitte wählen Sie ihren Kurs aus!");
					$("#timetableDialogAbort").before(lis);
					$("#timetableDialog").trigger("create");
					$("#timetableDialog").popup();
					
					if(empty == true) {noContent("Es existieren keine Matrikel bzgl. Ihres Studiengangs!"); return;}
					
					setTimeout(function(){open($("#timetableDialog"));}, 50);
				})
				.fail(ajaxErrorHandler);
		};

		/**
		 * Called by Configuration Dialog. At this point, a course was chosen.
		 * 
		 * @param Event e ... Click-Event of Link
		 */
		function courseChosen(e){
			var element = $(e.target);
			var course = element.text();

			loadingIn();
			CONFIG.TIMETABLE.temporary[0].groups.push({"id": course, "courses": {}});
			$("#timetableDialog").popup("close");

			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+CONFIG.TIMETABLE.semester+"/"+CONFIG.TIMETABLE.temporary[0].id+"/courses?semgroup="+course)
		 		.done(function (data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR, abortSetup); return;}

					var empty = true;
					var check = '<form><fieldset data-role="controlgroup">';
					
					for(var k in data) {
						var course = data[k];
							
						check += '<input type="checkbox" name="'+course+'" id="'+course+'" data-hash="'+k+'"><label for="'+course+'">'+course+'</label>';
						empty = false;
					}
					
					check += '</fieldset></form>';

					if(empty == true) {noContent("Es existieren keine Fächer bzgl. Ihres Matrikels!"); return;}
					
					check = $(check); 
					fillPopup("Einrichtung", "Bitte kreuzen Sie alle Kurse an, die Sie in ihrem Stundenplan möchten!","Ok", setCourses);
					$("#timetableDialogAbort").before(check);
					$("#timetableDialog").trigger("create");
					$("#timetableDialog").popup();
					
					setTimeout(function(){open($("#timetableDialog"));}, 50);
				})
				.fail(ajaxErrorHandler);
		}

		/**
		 * Called by Configuration Dialog. At this point, all needed subjects were marked.
		 * 
		 * @param Event e ... Click-Event of Link
		 */
		function setCourses(e){
			var element = $(e.target);
			var boxes = element.siblings("form").find("input");
			for(var k = 0; k < boxes.length; k++){
				var box = boxes.eq(k);
				if(box.prop("checked")){
					CONFIG.TIMETABLE.temporary[0].groups[0].courses[box.attr("data-hash")] = box.attr("name")
				}
			}
			$("#timetableDialog").popup("close");
			var courses = CONFIG.TIMETABLE.temporary[0].groups[0].courses;
			var ins = '<form>';
			for(var k in courses){
				ins += '<input type="text" name="text-'+k+'" id="text-'+k+'" value="'+courses[k]+'">';
			}
			ins += '</form>';
			ins = $(ins);

			fillPopup("Einrichtung", "Benennen Sie bitte alle Kurse so um, wie es Ihnen am besten gefällt","Ok", renameCourses);
			$("#timetableDialogAbort").before(ins);
			$("#timetableDialog").trigger("create");
			$("#timetableDialog").popup();
			
			setTimeout(function(){open($("#timetableDialog"));}, 50);
		}

		/**
		 * Called by Configuration Dialog. At this point, subjects were renamed. In this step, made configurations are saved permenantly.
		 * 
		 * @param Event e ... Click-Event of Link
		 */
		function renameCourses(e){
			var element = $(e.target);
			var boxes = element.siblings("form");
			var courses = CONFIG.TIMETABLE.temporary[0].groups[0].courses;

			for(var k in courses){
				var box = boxes.find('#text-'+k);
				courses[k] = box.val();
			}

			$("#timetableDialog").popup("close");

			//save courses
			var pushedc = false; var pushedg = false;
			for(var k in CONFIG.TIMETABLE.faculty){
				var faculty = CONFIG.TIMETABLE.faculty[k];
				if(faculty.id == CONFIG.TIMETABLE.temporary[0].id){
					for(var s in CONFIG.TIMETABLE.faculty[k].groups){
						var group = CONFIG.TIMETABLE.faculty[k].groups[s];
						if(group.id == CONFIG.TIMETABLE.temporary[0].groups[0].id){
							for(var l in courses){
								CONFIG.TIMETABLE.faculty[k].groups[s].courses[l] = courses[l]; //Add/Rename Courses
							}
							pushedc = true;
						}
					}
					if(pushedc == false) { //Nothing was pushed
						CONFIG.TIMETABLE.faculty[k].groups.push(CONFIG.TIMETABLE.temporary[0].groups[0]);//Add group
						pushedg = true;
					}
				}
			}
			if(pushedc == false && pushedg == false){//Nothing was pushed
				CONFIG.TIMETABLE.faculty.push(CONFIG.TIMETABLE.temporary[0]);//Add faculty
			}
			saveParameters();
			console.log(CONFIG.TIMETABLE.faculty);
			CONFIG.TIMETABLE.temporary = [];

			fillPopup("Einrichtung", "Wollen Sie weitere Kurse hinzufügen?","Ja", showConfigDialog);
			
			setTimeout(function(){open($("#timetableDialog"));}, 50);
		}

		/*********************************************************************************************************************
		  * END of "This Area is used for Timetable Configuration Dialogs"
		*/

		/**
		 * Loading the available Weeks and fill the preselected Timetable.
		 */
		function initTimetableView() {
			var date = new Date();
			var day = getWeekDay(date).id;

			var today = date.getDay();
			var dayselect = $("#timetable_day_select");
			dayselect.find('option:jqmData(selected="selected")').removeAttr("selected");
			dayselect.find('option:jqmData(day="'+today+'")').attr("selected", "selected");
			dayselect.selectmenu("refresh");
			
			timetableFill();
			
			GLOBAL.INIT.timetable = true;
		};

		/**
		 * Loading the selected Week into the Timetable.
		 */
		function fillTimetable() {
			var tbs = $("#timetable_days table tbody");
			var week = $("#timetable_week_select").val();
			var deferreds = [];
			var fac;
			
			loadingIn();
			for(var f in CONFIG.TIMETABLE.faculty) 
			{
				fac = CONFIG.TIMETABLE.faculty[f];
				for(var g in fac.groups)
				{
					deferreds[deferreds.length] = fillTimetableWeek(tbs, week, fac.id, fac.groups[g]);
				}
			}
			
			$.when.apply($, deferreds)
			 .then(function() {
				 for(var i=0;i<tbs.length;i++)
				 {
					var trs = tbs.eq(i).find("tr").detach();
					
					if(trs.length>0)
					{
						trs = trs.sort(function(a,b) {
							var o1 = $(a).find("td").first().text();
							var o2 = $(b).find("td").first().text();
							
							if(o1.length==4) o1 = "0"+o1;
							if(o2.length==4) o2 = "0"+o2;
							
							console.log(o1+" "+o2);
							
							if(o1==o2) return 0;
							else if(o1>o2) return 1;
							else return -1;
						});
						 
						 tbs.eq(i).append(trs);
					}
					else
					{
						tbs.eq(i)
						   .append('<tr><td colspan="8">Keine Veranstaltungen.</td></tr>')
						   .trigger("create");
					}
				 }
				 
				 loadingOut();
			 });
		};
		
		/**
		 * Fill the Timetable Day by Day for the given Faculty and Group in the given Week.
		 * 
		 * @param jQuery-Object tbs ... TBody's of Timetable
		 * @param String week ... Week Number
		 * @param String faculty ... Faculty ID (e.g. "FIMN")
		 * @param Array[Object] group ... Courses and Group ID from Settings
		 * 
		 * @return jQuery-Deferred
		 * 
		 * @see CONFIG.TIMETABLE
		 */
		function fillTimetableWeek(tbs, week, faculty, group) {
			return $.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+CONFIG.TIMETABLE.semester+"/"+faculty+"/week/"+week+"?semgroup="+group.id)
			 		.done(function (data, status, jqXHR) {
							if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR); return;}
			 				if(!isEmpty(data))
			 				{
			 					for(var k in data)
			 					{	
			 						addTimetableWeekday(tbs.eq(k), data[k].dayContent, group);
			 					}
			 				}
							loadingOut();
					})
					.fail(ajaxErrorHandler);
		};
		
		/**
		 * Adding Courses from the Request to the Weekday.
		 * 
		 * @param jQuery-Object tb ... TBody-Element (TBody representing the Day)
		 * @param Array courses ... all Courses for the Day
		 * @param Array[Object] group ... Courses and Group ID from Settings
		 * 
		 * @see CONFIG.TIMETABLE
		 */
		function addTimetableWeekday(tb, courses, group) {
			var trs = "";
			var n, c, d;

			if(!isEmpty(tb) && !isEmpty(courses))
			{
				for(var i=0;i<courses.length;i++)
				{	
					c = courses[i];
					n = group.courses[c.suid];
					d = (CONFIG.TIMETABLE.showDocentFullName && !isEmpty(c.docentDetailed))?c.docentDetailed:c.docent;
					
					if(!isEmpty(n))
					{	
						trs += 	'<tr>'+
									'<td>'+c.begin+'</td>'+
									'<td>'+c.end+'</td>'+
									'<td>'+c.kw+'</td>'+
									'<td>'+c.location+'</td>'+
									'<td>'+c.type+'</td>'+
									'<td>'+n+'</td>'+
									'<td>'+d+'</td>'+
									'<td>'+c.notes+'</td>'+
								'</tr>';
					}
				}
				
				tb.append(trs)
				  .trigger("create");
			}
		};
		
		/**
		 * 
		 */
		function timetableFill() {
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.timetable+"cal")
			 .done(function(data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR); return;}

			 		CONFIG.TIMETABLE.semester = data.semester;
					$("#timetable_day").attr("data-week", data.current);
					$("#actualWeek").empty().append(''+data[data.current]+'');
			 		
			 		if(CONFIG.TIMETABLE.faculty.length != 0) timetableFillDay();
			})
			.fail(ajaxErrorHandler);
		}

		function timetableFillDay(){
			for(var k in CONFIG.TIMETABLE.faculty){
				var faculty = CONFIG.TIMETABLE.faculty[k];
				for(var s in CONFIG.TIMETABLE.faculty[k].groups){
					var group = CONFIG.TIMETABLE.faculty[k].groups[s];
					for(var l in gropu.courses){
						//CONFIG.TIMETABLE.faculty[k].groups[s].courses[l] = courses[l]; //add course to timetable
					}
				}
			}
		}
	</script>
</div>
