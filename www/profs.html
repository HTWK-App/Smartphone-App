<div data-role="page" id="profs" data-title="Professoren" data-theme="a" data-content-theme="a">
	<div data-role="content" id="profs_content" class="toblur">
		<ul data-role="listview" id="profsList" data-autodividers="true" data-filter="true" data-inset="true">
		</ul>
	</div>

	<script>
		$( document ).on( "pagecreate", '[id="profs"]', function() {
			getProfs();
		});
		
		$( document ).on( "pageinit", '[id="profs"]', function() {
			$("#profsList").listview({
				autodividers: true,
				autodividersSelector: function (li) {
					var out = li.attr("data-department");
					return out;
				}
			}).listview("refresh");
		});

		function getProfs(){
			showLoader();
			$.getJSON( SERVER_URL+'info/staff/').done( function(data,a,b) {
				$("#profsList").empty();
				$.each( data, function( key, item ) {
					addProf(item.name,item.degree,item.faculty,item.cuid);
				});
				$("#profsList").listview("refresh");
				$.mobile.loading('hide'); 
				$('.prof').bind("click",function (e){
					changeToProf($(this).attr("data-id"));
				});
				showLoading = false;
			});
		}

		function changeToProf(id){
			showLoader();
			$.getJSON( SERVER_URL+'info/staff/'+id).done( function(data,a,b) {
				var pattern = 
				'<div data-role="page" id="profpage" data-title="back" data-theme="a" data-content-theme="a">'+
					'<div data-role="content" id="prof_content">'+
						'<h1>'+data.name+'</h1>'+
					'</div>'+
				'</div>';
				$( "body" ).append(pattern).trigger( "create" );
				$.mobile.loading('hide'); 
				showLoading = false;
				$.mobile.changePage('#profpage');
			});
		}

		function addProf(name, degree, department, id){
			var pattern = 
				'<li data-department="'+department+'" ><a href="#" class="prof" data-id="'+id+'">'+name+', '+degree+'</a></li>';
			$( "#profsList" ).append(pattern);
		}
	</script>
</div>
