<div data-role="page" id="profs" data-title="Professoren" data-theme="a" data-content-theme="a">
	<div data-role="content" id="profs_content" class="toblur">
		<ul data-role="listview" id="profsList" data-filter="true" data-filter-placeholder="Search professors..." data-inset="true">
		</ul>
	</div>

	<script>
		$( document ).on( "pagecreate", '[id="profs"]', function() {
			fillProfs();
		});
		
		$(document).on("pageshow",'[id="profs"]', function() {
			$('#profpage').detach();
		});

		function fillProfs(){
			showLoader();
			$.getJSON( SERVER_URL+'info/staff/').done( function(data,a,b) {
				var pos = $('#profsList');
				pos.empty();
				$.each( data, function( key, item ) {
					addProf(pos, item.name, item.degree, item.faculty, item.cuid);
				});
				pos.listview({
					autodividers: true,
					autodividersSelector: function (li) {
						var out = li.attr("data-department");
						return out;
					}
				});
				pos.listview("refresh");
				$('.prof').bind("click",function (e){
					changeToProf($(this).attr("data-id"));
				});
				$.mobile.loading('hide');
				showLoading = false;
			});
		}

		function changeToProf(id){
			showLoader();
			$.getJSON( SERVER_URL+'info/staff/'+id).done( function(data,a,b) {
				var help = data.name.split(", ");
				var pattern = 
				'<div data-role="page" id="profpage" data-title="back" data-theme="a" data-content-theme="a">'+
					'<div data-role="content" id="prof_content">'+
						'<h1>'+help[1]+' '+help[0]+'<img src="'+SERVER_URL+'info/staff/'+data.cuid+'/pic" id="prof-img" style="float: right"/></h1><hl>'+
						'<p><b>Grad:</b> '+data.degree+'</p>'+
						'<p><b>Bereich:</b> '+data.faculty+'<br><b>Objekt:</b> '+data.location+'</p>'+
						'<p><b>Beschreibung:</b> '+data.description+'</p>'+
						'<p><b>E-Mail:</b> <a href="mailto:'+data.email+'">'+data.email+'</a></p>'+
						'<p><b>Telefon:</b> <a href="tel:'+data.telephone+'">'+data.telephone+'</a></p>'+
						'<p><b>Fax:</b> '+data.telefax+'</p>'+
						'<p><b>Links:</b><br><a href="'+data.detailLink+'">Details zur Person</a><br>'+
						'<a href="'+data.vcardLink+'">V-Card</a></p>'
					'</div>'+
				'</div>';
				$( "body" ).append(pattern)
				$("#profpage").trigger( "create" );
				$.getJSON( SERVER_URL+'info/staff/'+id+'/pic').done( function(data,a,b) {
					console.log("data");
					//$( "#prof-img" ).append(data);
					//$("#profpage").trigger( "create" );
				});
				$.mobile.loading('hide'); 
				showLoading = false;
				window.location.href="#profpage";
			});
		}

		function addProf(pos, name, degree, department, id){
			var help = name.split(", ");
			var pattern = 
				'<li data-department="'+department+'" ><a class="prof" data-id="'+id+'">'+help[1]+' '+help[0]+', '+degree+'</a></li>';
			pos.append(pattern);
		}
	</script>
</div>
