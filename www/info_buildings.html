<div id="building_page" data-role="page" data-title="Gebäudeplan" data-theme='b' data-dom-cache="true">
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b' class="header">
		<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all btn_menu"><i class="fa fa-bars fa-lg"></i></a>
		<h1>HTWK App</h1>
	</div>
    
	<div role="main" class="ui-content">
		<br/>
		<ul id="buidling_content_list" data-role="listview" data-filter-placeholder="Suche Gebäude..." data-filter="true">
		</ul>
	</div>

	<script type="application/javascript" src="js/building.js"></script>
	<script>
		
		/*TODO
		 *
		 */
	    	$( "#building_page" )
	    		.on("pagecreate", buildingInitBuildingsView)
	    		.on("pageshow", function() {
	    			if(!GLOBAL.INIT.builds) loadingIn();
						$("#buidling_content_list li").removeClass("ui-screen-hidden");
						$("#buidling_content_list").listview("refresh");
	    		 })

		/**
		 * Fetches buildings from the Server. Will call buildingFillBuildingsList
		 *
		 */
		function buildingInitBuildingsView() {

			loadingIn();

			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.builds)
				.done(function(data, status, jqXHR) {
					if(!isEmpty(data.exception))
						{ ajaxErrorHandler(data, status, jqXHR); return; }

					buildingFillBuildingsList(data);

					loadingOut();
					GLOBAL.INIT.builds = true;
				})
				.fail(ajaxErrorHandler);
		}
		
		/**
		 * Fills the building list widget.
		 *
		 * @ param JSON-Object data
		 *
		 */
		function buildingFillBuildingsList(data) {

			var building, lis = "", desc = "";
			
			for(var k in data){
				building = data[k];
				
				for(var d in building.description){
					if(!isEmpty(building.description[d]))
						desc += building.description[d];
				}
				
				lis += 	'<li data-bid='+building.id+'><a href="#" class="building">'+
							'<h3>'+building.fullName+'</h3>'+
							'<p>'+desc+'</p>'+
							'<p>'+building.address+'</p>'+
						'</a></li>';
			}
				
			$( "#buidling_content_list" )
				.off()
				.empty()
				.append(lis)
				.on("click", "a.building", function (){buildingLoadBuildingDetails($(this).parents("li").first().data("bid"));})
				.listview("refresh")
				.trigger("updatelayout");
			
			$( "body" )
				.find("div.buildingdetails")
				.remove();
		}
	</script>
</div>
