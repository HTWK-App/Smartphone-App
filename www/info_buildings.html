<div id="building_page" data-role="page" data-title="Gebäudeplan" data-theme='b' data-display="push">
    <!--- HEADER --->
    <div data-role="header" data-position="fixed" data-theme='b' class="header">
    	<a data-role="button" data-iconpos='left' class="btn_menu"><span class="icon-ellipsis-vertical"></span></a>
    	<h1>HTWK App</h1>
    </div>
    <!--- HEADER --->
    
	<div data-role="content">
		<br/>
		<ul id="buidling_content_list" data-role="listview" data-filter-placeholder="Suche Gebäude..." data-filter="true" data-inset="true">
		</ul>
	</div>
	<style>
		.map-canvas{
			float: left; width: 70%; height: 100%;
		}
		.mapcontainer{
			float: right; width:30%; height: 100%;
		}
	</style>
	<script type="application/javascript" src="js/building.js"></script>
	<script>
		
		/*TODO
		 *
		 */
	    	$( "#building_page" )
	    		.on("pagecreate", buildingInitBuildingsView)
	    		.on("pageshow", function() {
	    			if(!GLOBAL.INIT.builds) loadingIn();
	    			/*$("#btn_refresh")
						.off()
						.on("click", buildingInitBuildingsView);*/
				$("#buidling_content_list li").removeClass("ui-screen-hidden");
				$("#buidling_content_list").listview("refresh");
	    		 })

		/**
		 * Fetches buildings from the Server. Will call buildingFillBuildingsList
		 *
		 */
		function buildingInitBuildingsView() {

			loadingIn();

			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.builds)
				.done(function(data, status, jqXHR) {
					if(!isEmpty(data.exception))
						{ ajaxErrorHandler(data, status, jqXHR); return; }

					buildingFillBuildingsList(data);

					loadingOut();
					GLOBAL.INIT.builds = true;
				})
				.fail(ajaxErrorHandler);
		}
		
		/**
		 * Fills the building list widget.
		 *
		 * @ param JSON-Object data
		 *
		 */
		function buildingFillBuildingsList(data) {

			var building, lis = "", desc = "";
			
			for(var k in data){
				building = data[k];
				
				for(var d in building.description){
					if(!isEmpty(building.description[d]))
						desc += building.description[d];
				}
				
				lis += 	'<li data-bid='+building.id+'><a href="#" class="building">'+
							'<h3>'+building.fullName+'</h3>'+
							'<p>'+desc+'</p>'+
							'<p>'+building.address+'</p>'+
						'</a></li>';
			}
				
			$( "#buidling_content_list" )
				.off()
				.empty()
				.append(lis)
				.on("click", "a.building", function (){buildingLoadBuildingDetails($(this).parents("li").first().data("bid"));})
				.listview("refresh")
				.trigger("updatelayout");
			
			$( "body" )
				.find("div.buildingdetails")
				.remove();
		}
	</script>
</div>
