<div id="staff_page" data-role="page" data-title="Mitarbeiter & Professoren" data-theme='b' data-dom-cache="true">
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b' class="header">
		<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all btn_menu"><i class="fa fa-bars fa-lg"></i></a>
		<h1>HTWK App</h1>
	</div>
    
	<div role="main" class="ui-content">
		<ul id="staff_content_list" data-role="listview" data-filter-reveal="true" data-filter-placeholder="Suche ..." data-filter="true"></ul>
	</div>
	<script type="application/javascript" src="js/staff.js"></script>
	<script>

    		$( "#staff_page" )
	    		.on("pagecreate", staffInitStaffView)
	    		.on("pageshow", function() {
	    			if(!GLOBAL.INIT.staff) loadingIn();
	    		 });

		/**
		 * Fetches staff from the Server. Will call staffFillStaffList
		 *
		 */
		function staffInitStaffView() {

			loadingIn();

			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.staff)
				.done(function(data, status, jqXHR) {
					if(!isEmpty(data.exception))
						{ ajaxErrorHandler(data, status, jqXHR); return; }

					staffFillStaffList(data);

					loadingOut();
					loadingIn("Geben Sie bitte einen Suchbegriff ein. Danach sehen sie die gew√ºnschten Mitarbeiter!",true);
					setTimeout(loadingOut, 3000);
					GLOBAL.INIT.staff = true;
				})
				.fail(ajaxErrorHandler);
		}

		/**
		 * Fills the staff list widget.
		 *
		 * @ param JSON-Object data
		 *
		 */
		function staffFillStaffList(data) {

			var emp, name;
			var lis = "";
			
			for(var k in data){
				emp = data[k];
				name = emp.name.split(", ");
			
				lis += '<li class="ui-screen-hidden" data-cuid="'+emp.cuid+'">'+
						'<a href="#" class="staff">'+
						'<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.staff+emp.cuid+'/thumb" height="64" width="64" class="staffpic">'+
							name[1]+' '+name[0]+', '+emp.degree+
							'<p>'+emp.faculty+'</p>'+
						'</a></li>';
			}
		
			$( "#staff_content_list" )
				.off()
				.empty()
				.append(lis)
				.on("click", "a.staff", function (){
					loadStaffDetails($(this).parents("li").first().data("cuid"));
				})
				.listview("refresh")
				.trigger("updatelayout");
		}
	</script>
</div>
