<div id="sport_page" data-role="page" data-dom-cache="true" data-title="Hochschulsport" data-theme="a" data-content-theme="a">
	<div data-role="content" class="toblur">
		<ul id="sport_content_list" data-role="listview" data-filter-placeholder="Suche Sportart..." data-filter="true" data-inset="true"></ul>
	</div>

	<script>	
    	$( "#sport_page" )
    		.on("pagecreate", initSportsView)
    		.on("pageshow", function() {
    			if(!GLOBAL.INIT.sport) loadingIn();
    			$("#btn_refresh")
					.off()
					.on("click", initSportsView);
    		 });

    	/**
    	 * Loading the List of all Sport Courses.
    	 */
		function initSportsView() {
			loadingIn();
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.sport)
			 .done(function(data, status, jqXHR) {
				 	var sport, lis = "";
					
					if(!isEmpty(data))
					{				
						for(var k in data)
						{
							sport = data[k];
							
							lis += 	'<li data-sport='+sport.id+'><a href="#" class="sport">'+
										'<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.sport+'/'+sport.id+'/pic" />'+
										'<h3>'+sport.title+'</h3>'+
										'<p>'+sport.description+'</p>'+
									'</a></li>';
						}
						
						$( "#sport_content_list" )
							.off()
							.empty()
							.append(lis)
							.on("click", "a.sport", loadSportDetails)
							.trigger("create")
							.listview("refresh")
							.trigger("updatelayout");
						
						$( "body" )
							.find("div.sportdetails")
							.remove();
					}
				
					loadingOut();
					GLOBAL.INIT.sport = true;
			  });
			//.fail(ajaxErrorHandler);
		};

		function loadSportDetails(e) {
			var id = $(e.target).parents("li").first().data("sport");
			
			// already cached?
			if($("#sport_"+id).length>0) {
				$.mobile.initializePage();
				$.mobile.changePage("#sport_"+id);
				return true;
			}

			loadingIn();
			
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.sport+"/"+id)
			 .done(function(data, status, jqXHR) {
				 	// simple Fix for empty Response, TODO better?
				 	if(isEmpty(data.id)) return;
				
    				var div = '<div id="sport_'+data.id+'" data-role="page" data-title="'+data.title+'" data-subpage="true" class="sportdetails" data-theme="a" data-content-theme="a">'+
    							'<div data-role="content">'+
    							    '<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.sport+'/'+data.id+'/pic" />'+
    								'<h1>'+data.title+'</h1>'+
    								'<p><b>Kursnummer:</b> '+data.courseNumber.match(/\d+/)[0]+'</p>'+
    								'<p><b>Zeitspanne:</b> '+data.time+'</p>'+
    								'<p><b>Geschlecht:</b> '+data.gender+'</p>'+
    								'<p><b>Beschreibung:</b> '+data.description+'</p>'+
    								'<p><a href="'+data.detailedLink+'">Weitere Informationen</a></p>'+
    								'<p><b>Ort:</b> '+data.location+'</p>'+
    								'<p><b>Zeiten:</b> '+data.cycle+'</p>'+
    								'<p><b>Betreuer/in:</b> '+data.leader+'</p>'+
    								'<p><b>Hinweise:</b></p>';
				
    				if(!isEmpty(data.hints))
    				{
    					div += '<ul>';
    					
    					for(var k in data.hints)
    					{
    						div += '<li>'+data.hints[k]+'</li>';
    					}
    					
    					div += '</ul>';
    				}
					
    				div += 			'<p><b>Auslastung des Kurses:</b> '+data.competitor+'</p>'+
						 	    '</div>'+
						 	  '</div>';
				
    				$( "body" )
						.append(div)
						.trigger("create");
				
    				$.mobile.initializePage();
    				$.mobile.changePage("#sport_"+id);
				
    				loadingOut();
			  });
			//.fail(ajaxErrorHandler);
			
			return true;
		};
	</script>
</div>