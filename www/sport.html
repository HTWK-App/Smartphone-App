<div id="sport_page" data-dom-cache="true" data-role="page" data-dom-cache="true" data-theme='b'>
	<div data-role="panel" id="menue_sport" data-theme="a" data-display="push">
		<ul data-role="listview">
			<li data-role="list-divider">Hauptmenü</li>
			<li data-icon="fire"><a href="index.html" >Startseite</a></li>
			<li data-icon="fire"><a href="news.html" >News</a></li>
			<li data-icon="trophy"><a href="timetable.html" >Stundenplan</a></li>
			<li data-icon="trophy"><a href="canteen.html" >Mensa</a></li>
			<li data-icon="trophy"><a href="mail.html" >Postfach</a></li>
			<li data-icon="trophy"><a href="qis.html" >QIS</a></li>
			<li data-icon="trophy"><a href="sport.html" >Hochschulsport</a></li>
			
		</ul>
		<!--<div data-role="collapsible"><h4>Info-Center</h4> -->
		<ul data-role="listview">
			<li data-role="list-divider">Info-Center</li>
			<li data-icon="trophy"><a href="info_general.html" >Allgemein</a></li>
			<li data-icon="trophy"><a href="info_staff.html" >Mitarbeiter</a></li>
			<li data-icon="trophy"><a href="info_buildings.html" >Gebäudeplan</a></li>
			<li data-icon="trophy"><a href="info_wlan.html" >WLAN-Konfiguration</a></li>
		</ul>
		<!--</div> -->
		<ul data-role="listview">
			<li data-role="list-divider">Tools</li>
			<li data-icon="trophy"><a href="room_search.html" >Leeren Raum finden</a></li>
			
		</ul>
		<ul data-role="listview">
			<li data-role="list-divider">Einstellungen</li>
			<li data-icon="trophy"><a href="settings.html" >HTWK-App</a></li>
		</ul>
	</div>
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
		<a href="#menue_sport" data-role='button' role="button" data-iconpos='left' data-inline='true'><i class="icon-ellipsis-vertical"></i>&nbsp;</a>
		<h1>&nbsp;HTWK App</h1>
	</div>
	<div data-role="content">
		<br/>
		<ul id="sport_content_list" data-role="listview" data-filter-placeholder="Suche Sportart..." data-filter="true" data-filter-reveal="true" data-inset="true">
		</ul>	
	</div>

	<script>

		/*TODO
		 * See sportLoadSportDetails
		 */
	    	$( "#sport_page" )
	    		.on("pagecreate", sportInitSportsView)
	    		.on("pageshow", function() {
	    			if(!GLOBAL.INIT.sport) loadingIn();
	    			$("#btn_refresh")
					.off()
					.on("click", sportInitSportsView);
	    		 });

    		/**
    		 * Fetches the list of all sport courses from Server and fills the list widget.
    		 */
		function sportInitSportsView() {

			loadingIn();

			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.sport)
				.done(function(data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR); return;}

				 	var sport, lis = "";
					
					if(!isEmpty(data)){				
						for(var k in data){
							sport = data[k];
							
							lis += 	'<li data-sport='+sport.id+'><a href="#" class="sport">'+
										'<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.sport+'/'+sport.id+'/pic" />'+
										'<h3>'+sport.title+'</h3>'+
										'<p>'+sport.description+'</p>'+
									'</a></li>';
						}
						
						$( "#sport_content_list" )
							.off()
							.empty()
							.append(lis)
							.on("click", "a.sport", sportLoadSportDetails)
							.trigger("create")
							.listview("refresh")
							.trigger("updatelayout");
						
						$( "body" )
							.find("div.sportdetails")
							.remove();
					}
				
					loadingOut();
					GLOBAL.INIT.sport = true;
				})
				.fail(ajaxErrorHandler);
		}

    		/**
    		 * Fetches the specfied sport from the server and creates a new page. At least, it changes onto this page.
		 *
		 * @param Event e
		 *
    		 */
		function sportLoadSportDetails(e) {

			var id = $(e.target).parents("li").first().data("sport");
			
			// already cached?
			if($("#sport_"+id).length > 0) {
				$.mobile.initializePage();
				$.mobile.changePage("#sport_"+id);
				return true;
			}

			loadingIn();
			
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.sport+"/"+id)
				.done(function(data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR); return;}

				 	if(isEmpty(data.id)){ // simple Fix for empty Response, TODO better?
						loadingIn("Es ist ein Fehler aufgetreten!",true);
						setTimeout(loadingOut, 3000);
						return;
					}
				
	    				var div = '<div id="sport_'+data.id+'" data-role="page" data-title="'+data.title+'" data-subpage="true" class="sportdetails" data-theme="b">'+
							'<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="b">'+
							'	<a href="#" data-rel="back" data-role="button" data-transition="slide" data-direction="reverse"><i class="icon-angle-left"></i></a>'+
							'	<h1>&nbsp;HTWK App</h1>'+
							'</div>'+
	    						'<div data-role="content"><div class="inset"><br/>'+
							'	<h1>'+data.title+'</h1>'+
							'	<ul data-nativedroid-plugin="cards" class="nativeDroidCards">'+
							'		<li data-cards-type="text">'+
							'			<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.sport+'/'+data.id+'/pic" />'+
							'		</li>'+
							'		<li data-cards-type="text">'+
							'			<h1>Beschreibung</h1><hr/>'+
							'			<p>'+data.description+'</p>'+
							'		</li>'+
							'		<li data-cards-type="text">'+
							'			<h1>Info</h1><hr/>'+
							'			<p>'+
							'				<b>Zeitspanne:</b><br/>'+data.time+'<br/>'+data.cycle+
							'				<br/><b>Geschlecht:</b><br/>'+data.gender+
							'				<br/><b>Auslastung des Kurses:</b></br> '+data.competitor+
							'				<br/><b>Ort:</b><br/>'+data.location+
							'				<br/><b>Betreuer/in:</b><br/>'+data.leader+
							'				<br/><a href="'+data.detailedLink+'">Weitere Informationen</a>'+
							'			</p>'+
							'		</li>'+
							'		<li data-cards-type="text">'+
							'			<h1>Hinweise</h1><hr/>';
				
    					if(!isEmpty(data.hints)){
    						div += '<ul>';
    					
    						for(var k in data.hints){
    							div += '<li>'+data.hints[k]+'</li>';
    						}
    					
    						div += '</ul>';
    					}
					
	    				div += 		'		</li>'+
							'	</ul>'+
						'	</div>'+
						'</div>'+
						'</div>';

					div = $(div);
					div.find("div[data-role='content'] a").addClass("external");
				
	    				$( "body" )
						.append(div)
						.trigger("create");
				
	    				$.mobile.initializePage();
	    				$.mobile.changePage("#sport_"+id);
				
	    				loadingOut();
			 	})
				.fail(ajaxErrorHandler);
		}

	</script>
</div>
