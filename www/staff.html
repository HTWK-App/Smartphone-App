<div id="staff_page" data-role="page" data-dom-cache="true" data-title="Mitarbeiter" data-theme="a" data-content-theme="a">
	<div data-role="content" class="toblur">
		<ul id="staff_content_list" data-role="listview" data-filter="true" data-filter-reveal="true" data-filter-placeholder="Suche Mitarbeiter..." data-inset="true"></ul>
	</div>

	<script>
		/*$( document )
			.on("pagecreate", "#profs", initProfView)
			.on("pageshow", "#profs", function() {
				$("#profpage").detach();
			 });*/
	
    	$( "#staff_page" )
    		.on("pagecreate", initStaffView)
    		.on("pageshow", function() {
    			if(!GLOBAL.INIT.staff) loadingIn();
    			$("#btn_refresh")
					.off()
					.on("click", initStaffView);
    			//$("#staffdetails").detach();
    		 });

		function initStaffView() {
			loadingIn();
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.staff)
			 .done(function(data, status, jqXHR) {
				 fillStaffList(data);
				 loadingOut();
				 GLOBAL.INIT.staff = true;
			  });
			// TODO fail
			
			/*$.getJSON( SERVER_URL+'info/staff/').done( function(data,a,b) {
				var pos = $('#profsList');
				var pattern = "";
				pos.empty();
				$.each( data, function( key, item ) {
					pattern += addProf(item.name, item.degree, item.faculty, item.cuid);
				});
				pos.append(pattern);
				$('.prof').bind("click",function (e){
					changeToProf($(this).attr("data-id"));
				});
				pos.listview("refresh");
				pos.trigger( "updatelayout");
				$.mobile.loading('hide');
				showLoading = false;
			});*/
		};
		
		function fillStaffList(data) {
			var emp, name;
			var lis = "";
			
			if(!isEmpty(data))
			{
				for(var k in data)
				{
					emp = data[k];
					name = emp.name.split(", ");
					
					lis += 	'<li class="ui-screen-hidden" data-cuid="'+emp.cuid+'">'+
								'<a href="#" class="staff">'+
								'<img src="'CONFIG.SERVER.base+CONFIG.SERVER.staff+emp.cuid'/thumb">'+
									name[1]+' '+name[0]+', '+emp.degree+
									'<p>'+emp.faculty+'</p>'+
							'</a></li>';
				}
				
				$( "#staff_content_list" )
					.off()
    				.empty()
    				.append(lis)
    				.on("click", "a.staff", loadStaffDetails)
    				.listview("refresh")
    				.trigger("updatelayout");
				
				$( "body" )
					.find("div.staffdetails")
					.remove();
			}
		};

		function loadStaffDetails(e) {
			var id = $(e.target).parents("li").first().data("cuid");
			
			if($("#staff_"+id).length>0) {
				$.mobile.initializePage();
				$.mobile.changePage("#staff_"+id);
				return;
			}
			
			loadingIn();
			
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.staff+id)
			 .done(function(data, status, jqXHR) {
				var name = data.name.split(", ");
				var div = 	'<div id="staff_'+id+'" data-role="page" data-title="Mitarbeiter" data-subpage="true" class="staffdetails" data-theme="a" data-content-theme="a">'+
								'<div data-role="content">'+
									'<h1>'+name[1]+' '+name[0]+'<img src="'+CONFIG.SERVER.base+CONFIG.SERVER.staff+id+'/pic" style="float: right" /></h1>'+
									'<hr>'+
									'<p><b>Grad:</b> '+data.degree+'</p>'+
									'<p><b>Bereich:</b> '+data.faculty+'</br><b>Objekt:</b> '+data.location+'</p>'+
									'<p><b>Beschreibung:</b> '+data.description+'</p>'+
									'<p><b>E-Mail:</b> <a href="mailto:'+data.email+'">'+data.email+'</a></p>'+
									'<p><b>Telefon:</b> <a href="tel:'+data.telephone+'">'+data.telephone+'</a></p>'+
									'<p><b>Fax:</b> '+data.telefax+'</p>'+
									'<p><b>Links:</b></br><a href="'+data.detailLink+'">Details zur Person</a></br>'+
									'<a href="'+data.vcardLink+'">V-Card</a></p>'+
								'</div>'+
							'</div>';
				
				$( "body" )
					.append(div)
					.trigger("create");
				
				$.mobile.initializePage();
				$.mobile.changePage("#staff_"+id);
				
				loadingOut();
			});
		};
		
		/*function loadProfDetail(id){
			$(this).attr("data-id")
			showLoader();
			$.getJSON( SERVER_URL+'info/staff/'+id).done( function(data,a,b) {
				var help = data.name.split(", ");
				var pattern = 
				'<div data-role="page" id="profpage" data-title="back" data-theme="a" data-content-theme="a">'+
					'<div data-role="content" id="prof_content">'+
						'<h1>'+help[1]+' '+help[0]+'<img src="'+SERVER_URL+'info/staff/'+data.cuid+'/pic" id="prof-img" style="float: right"/></h1><hl>'+
						'<p><b>Grad:</b> '+data.degree+'</p>'+
						'<p><b>Bereich:</b> '+data.faculty+'<br><b>Objekt:</b> '+data.location+'</p>'+
						'<p><b>Beschreibung:</b> '+data.description+'</p>'+
						'<p><b>E-Mail:</b> <a href="mailto:'+data.email+'">'+data.email+'</a></p>'+
						'<p><b>Telefon:</b> <a href="tel:'+data.telephone+'">'+data.telephone+'</a></p>'+
						'<p><b>Fax:</b> '+data.telefax+'</p>'+
						'<p><b>Links:</b><br><a href="'+data.detailLink+'">Details zur Person</a><br>'+
						'<a href="'+data.vcardLink+'">V-Card</a></p>'+
					'</div>'+
				'</div>';
				$( "body" ).append(pattern);
				$.mobile.initializePage();
				$.mobile.loading('hide'); 
				showLoading = false;
				$.mobile.changePage('#profpage');
			});
		};*/

		/*function addProf(name, degree, department, id){
			var help = name.split(", "); 
			return '<li class="ui-screen-hidden"><a class="prof" data-id="'+id+'">'+help[1]+' '+help[0]+', '+degree+'<p>'+department+'</p></a></li>';
		}*/
	</script>
</div>
