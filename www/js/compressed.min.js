//PushNotification.js, pushnotificationsupport.js,gmaps.js,config.js,fn.js
function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function isEmpty(e){return e===""||e==={}||e===null||e===undefined||e instanceof Array&&e.length===0}function createServerDateStamp(e){if(isEmpty(e))e=new Date;var t=e.getDate();var n=e.getMonth()+1;var r=e.getFullYear();if(t<10)t="0"+t;if(n<10)n="0"+n;return r+""+n+""+t}function createDateStamp(e){if(isEmpty(e))e=new Date;var t=e.getDate();var n=e.getMonth()+1;var r=e.getFullYear();if(t<10)t="0"+t;if(n<10)n="0"+n;return GLOBAL.DATE.weekdays[e.getDay()].name+", "+t+"."+n+"."+r}function formatDate(e,t){return createServerDateStamp(e).replace(GLOBAL.DATE.formats.regexp,t)}function createDateTimeStamp(e){if(isEmpty(e))e=new Date;var t=e.getDate();var n=e.getMonth()+1;var r=e.getFullYear();var i=e.getHours();var s=e.getMinutes();var o=e.getSeconds();if(t<10)t="0"+t;if(n<10)n="0"+n;if(i<10)i="0"+i;if(s<10)s="0"+s;if(o<10)o="0"+o;return t+"."+n+"."+r+" "+i+":"+s+":"+o}function getWeek(e){var t=new Array(5);if(e.getDay()==0){e.setDate(e.getDate()+1)}else if(e.getDay()==6){e.setDate(e.getDate()+2)}e.setDate(e.getDate()-e.getDay()+1);t[0]=new Date(e);for(var n=1;n<5;n++){t[n]=new Date(e.setDate(e.getDate()+1))}return t}function getWeekDay(e){if(e.getDay()==0||e.getDay()==6){return GLOBAL.DATE.weekdays[1]}else{return GLOBAL.DATE.weekdays[e.getDay()]}}function escape(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function loadingIn(e,t){if(isEmpty(t)){t=false}if(isEmpty(e)){e="Daten werden abgerufen"}$.mobile.loading("show",{text:e,textVisible:true,textonly:t,disabled:true,theme:"a"})}function loadingOut(){$.mobile.loading("hide")}function openSignInDialog(e){$("#signInDialog_Btn_Save").off().on("click",{callback:e},function(e){saveUsernamePassword($("#signInDialogUsername").val(),$("#signInDialogPassword").val(),function(){if($.isFunction(e.data.callback))e.data.callback.call(this);$("#signInDialog").popup("close")})});$("#signInDialog").css("display","block").popup("open",{positionTo:"window",transition:"pop"})}function saveUsernamePassword(e,t,n,r){loadingIn("Ihre Einstellungen werden gespeichert...");CONFIG.AUTH.username=e;CONFIG.AUTH.checking=true;$.post(CONFIG.SERVER.base+CONFIG.SERVER.auth+"?username="+e+"&password="+t).done(function(e,t,i){CONFIG.AUTH.credentials=e.encryptedCredentials;CONFIG.AUTH.salt=e.salt;loadingOut();loadingIn("Es wird geprüft, ob ihre Daten korrekt sind...");$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.mailg+"?credentials="+CONFIG.AUTH.credentials+"&salt="+CONFIG.AUTH.salt+"&offset=1").done(function(e,t,i){loadingOut();if(!isEmpty(e.exception)){CONFIG.AUTH.username="";CONFIG.AUTH.credentials="";CONFIG.AUTH.salt="";CONFIG.AUTH.correct=false;CONFIG.AUTH.checking=false;loadingIn("Ihre Daten waren inkorrekt. Bitte versuchen Sie es erneut!",true)}else{CONFIG.AUTH.correct=true;CONFIG.AUTH.checking=false;localStorage.setItem("username",CONFIG.AUTH.username);localStorage.setItem("credentials",CONFIG.AUTH.credentials);localStorage.setItem("salt",CONFIG.AUTH.salt);loadingIn("Ihre Daten waren korrekt und wurden gespeichert!",true)}setTimeout(loadingOut,3e3);if($.isFunction(n)&&CONFIG.AUTH.correct)n.call(this);if($.isFunction(r)&&!CONFIG.AUTH.correct)r.call(this)})})}function openInExternalBrowser(e){window.open($(e.target).attr("href"),"_system","location=yes");e.preventDefault()}function loadParameters(){var e=localStorage.getItem("username");if(e!=undefined)CONFIG.AUTH.username=e;e=localStorage.getItem("credentials");if(e!=undefined)CONFIG.AUTH.credentials=e;e=localStorage.getItem("salt");if(e!=undefined)CONFIG.AUTH.salt=e;e=localStorage.getItem("language");if(e!=undefined)CONFIG.LANGUAGE.set=e;e=localStorage.getItem("defaultFeed");if(e!=undefined)CONFIG.NEWS.defaultFeed=e;e=localStorage.getItem("defaultCanteen");if(e!=undefined)CONFIG.MENSA.defaultCanteen=e;e=localStorage.getItem("timetable");if(e!=undefined){CONFIG.TIMETABLE=JSON.parse(e)}delete loadParameters}function saveParameters(){localStorage.setItem("username",CONFIG.AUTH.username);localStorage.setItem("credentials",CONFIG.AUTH.credentials);localStorage.setItem("salt",CONFIG.AUTH.salt);localStorage.setItem("language",CONFIG.LANGUAGE.set);localStorage.setItem("defaultFeed",CONFIG.NEWS.defaultFeed);localStorage.setItem("defaultCanteen",CONFIG.MENSA.defaultCanteen);localStorage.setItem("timetable",JSON.stringify(CONFIG.TIMETABLE))}function ajaxErrorHandler(e,t,n,r){loadingOut();var i="Leider ist ein Fehler aufgetreten. Versuchen Sie es später erneut!";loadingIn(i,true);$("#menu").panel("open");setTimeout(loadingOut,4e3);if($.isFunction(r))r.call(this)}function registerDevice(){registerPushEvents();try{pushNotification=window.plugins.pushNotification;if(device.platform=="android"||device.platform=="Android"){pushNotification.register(successHandler,errorHandler,{senderID:CONFIG.PUSH.senderId,ecb:"onNotificationGCM"})}else{$("#app-status-ul").append("<li>registering iOS</li>");pushNotification.register(tokenHandler,errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})}CONFIG.PUSH.registered=true}catch(e){CONFIG.PUSH.registered=false;txt="There was an error on this page.\n\n";txt+="Error description: "+e.message+"\n\n";alert(txt)}}function onNotificationAPN(e){if(e.alert){$("#app-status-ul").empty().append("<li>push-notification: "+e.alert+"</li>");navigator.notification.alert(e.alert)}if(e.sound){var t=new Media(e.sound);t.play()}if(e.badge){pushNotification.setApplicationIconBadgeNumber(successHandler,e.badge)}}function onNotificationGCM(e){switch(e.event){case"registered":if(e.regid.length>0){$.post(CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"/register?regid="+e.regid).done(function(t,n,r){CONFIG.PUSH.regid=e.regid;CONFIG.PUSH.registered=true});console.log("regID = "+e.regid)}break;case"message":if(e.foreground){}else{if(e.coldstart){}else{}}$.event.trigger(""+e.payload.status,e.payload);fillPushNotifictionCard(e.payload.title,e.payload.message,e.payload.site);break;case"error":$("#app-status-ul").append("<li>ERROR -> MSG:"+e.msg+"</li>");break;default:$("#app-status-ul").append("<li>EVENT -> Unknown, an event was received and we do not know what it is</li>");break}}function unregisterDevice(){pushNotification.unregister(successUnregisterHandler,errorHandler)}function tokenHandler(e){$("#app-status-ul").append("<li>token: "+e+"</li>")}function successUnregisterHandler(e){$.ajax({url:CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"/delete"+"?regid="+CONFIG.PUSH.regid,type:"GET",success:function(e){CONFIG.PUSH.regid="";CONFIG.PUSH.registered=false},error:function(e,t,n){var r="("+e.responseText+")";alert(JSON.stringify(n))},complete:function(){unRegisterPushEvents();$("#app-status-ul").empty().append("<li>successfully unregistered device: "+e+"</li>")}})}function successHandler(e){$("#app-status-ul").empty().append("<li>successfully registered device: "+e+"</li>")}function errorHandler(e){$("#app-status-ul").empty().append("<li>error while connecting to pushNotificationService: "+e+"</li>")}function registerPushEvents(){for(key in CONFIG.PUSH.STATUS){$.event.trigger({type:key});$(document).on(key,eventHandler.get(key))}}function unRegisterPushEvents(){for(key in CONFIG.PUSH.STATUS){$(document).off(key)}}var PushNotification=function(){};PushNotification.prototype.register=function(e,t,n){if(t==null){t=function(){}}if(typeof t!="function"){console.log("PushNotification.register failure: failure parameter not a function");return}if(typeof e!="function"){console.log("PushNotification.register failure: success callback parameter must be a function");return}cordova.exec(e,t,"PushPlugin","register",[n])};PushNotification.prototype.unregister=function(e,t){if(t==null){t=function(){}}if(typeof t!="function"){console.log("PushNotification.unregister failure: failure parameter not a function");return}if(typeof e!="function"){console.log("PushNotification.unregister failure: success callback parameter must be a function");return}cordova.exec(e,t,"PushPlugin","unregister",[])};PushNotification.prototype.setApplicationIconBadgeNumber=function(e,t){if(errorCallback==null){errorCallback=function(){}}if(typeof errorCallback!="function"){console.log("PushNotification.setApplicationIconBadgeNumber failure: failure parameter not a function");return}if(typeof e!="function"){console.log("PushNotification.setApplicationIconBadgeNumber failure: success callback parameter must be a function");return}cordova.exec(e,e,"PushPlugin","setApplicationIconBadgeNumber",[{badge:t}])};if(!window.plugins){window.plugins={}}if(!window.plugins.pushNotification){window.plugins.pushNotification=new PushNotification}var CONFIG={SERVER:{base:"http://141.57.21.45:8080/",staff:"info/staff/",builds:"info/building",sport:"info/sport",academical:"info/academical/",news:"news",weather:"weather?location=",mensa:"mensa",timetable:"timetable/",auth:"auth",qis:"qis/get",room:"room/",mailg:"mailbox/get",mailn:"mailbox/new",mails:"mailbox/send",pushnotification:"auth/push"},LANGUAGE:{availableShort:["de_DE","en_EN"],availableLong:["Deutsch","English"],set:"de_DE"},AUTH:{username:"",password:"",credentials:"",salt:"",checking:false,correct:false},PUSH:{senderId:"1058861665734",enabled:false,regid:"",registered:false,STATUS:{1e3:"pushRequest",2e3:"newNews",4001:"newMail"}},GENERAL:{student:true,name:""},TIMETABLE:{semester:null,showDocentFullName:false,faculty:[],temporary:[]},NEWS:{defaultFeed:"rss.htwk.3"},MENSA:{defaultCanteen:118},AJAX:{scriptCharset:"utf-8",contentType:"application/json; charset=utf-8",headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"}}};var GLOBAL={SCREEN:{height:0,width:0},INIT:{news:false,index:false,timetable:false,mensa:false,mail:false,qis:false,sport:false,staff:false,builds:false,wlan:false,info:false,room:false,settings:false},DATE:{formats:{regexp:/(\d{4})(\d{2})(\d{2})/,en:"$1-$2-$3",de:"$3.$2.$1"},weekdays:{0:{id:"Son",name:"Sonntag"},1:{id:"Mon",name:"Montag"},2:{id:"Tue",name:"Dienstag"},3:{id:"Wed",name:"Mittwoch"},4:{id:"Thu",name:"Donnerstag"},5:{id:"Fri",name:"Freitag"},6:{id:"Sat",name:"Samstag"}},currentWeek:null,currentPlanWeek:0},NEWS:{titles:{"rss.digiboard":"HTWK Digiboard","rss.eit.1":"EIT Kolloquien-Termine","rss.eit.2":"EIT Kolloquien-Nachrichten","rss.htwk.1":"HTWK Veranstaltungen","rss.htwk.2":"HTWK Stellenausschreibungen","rss.htwk.3":"HTWK Nachrichten","rss.imn.1":"IMN Nachrichten","rss.imn.2":"IMN Verteidigungen","rss.imn.3":"IMN Termine","rss.me.1":"ME Fachschaftsrat","rss.medien":"ME Nachrichten","rss.sport":"Sportportal","rss.stura":"HTWK Studentenrat","rss.wiwi":"WiWi Fachschaftsrats-Termine","rss.lvz.news":"LVZ Leipzig Nachrichten"}},MAIL:{filter:/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/g}};var GMAPS={destination:[],mapcontainer:null,initGmap:function(e,t){GMAPS.destination=e;GMAPS.mapcontainer=t;navigator.geolocation.getCurrentPosition(GMAPS.onGeoGetSuccess,GMAPS.onGeoGetFail,{timeout:3e4,maximumAge:7e3,enableHighAccuracy:true})},onGeoGetFail:function(e){GMAPS.mapcontainer.find(".map-canvas").parent().empty().append("<p>Eine Karte kann nicht angezeigt werden, da die Ortsbestimmung fehgeschlagen ist.</p>")},onGeoGetSuccess:function(e){GMAPS.calcRoute([parseFloat(e.coords.latitude),parseFloat(e.coords.longitude)])},calcRoute:function(e){var t=new google.maps.DirectionsService;var n={zoom:7,disableDefaultUI:true,draggable:false,keyboardShortcuts:false,scrollwheel:false,mapTypeId:google.maps.MapTypeId.WALKING};var r=new google.maps.Map(GMAPS.mapcontainer.find(".map-canvas")[0],n);var i=new google.maps.DirectionsRenderer({map:r});var s=new google.maps.LatLng(e[0],e[1]);var o=new google.maps.LatLng(GMAPS.destination[0],GMAPS.destination[1]);var u={origin:s,destination:o,travelMode:google.maps.TravelMode.WALKING};t.route(u,function(e,t){if(t==google.maps.DirectionsStatus.OK){i.setDirections(e)}})}};var pushNotification;var eventHandler=function(){var e={};var t={};t.set=function(t){return function(n){t&&(e[t]=n)}};t.get=function(t){return e[t]};return t}();eventHandler.set(1e3)(function(t,n){$.post(CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"?credentials="+CONFIG.AUTH.credentials+"&salt="+CONFIG.AUTH.salt+"&regid="+CONFIG.PUSH.regid).done(function(e,t,n){if(e!="true"){alert("failure")}})});eventHandler.set(4001)(function(t,n){});eventHandler.set(2e3)(function(t,n){})
