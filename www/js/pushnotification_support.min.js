function registerDevice(){registerPushEvents();try{pushNotification=window.plugins.pushNotification;if(device.platform=="android"||device.platform=="Android"){pushNotification.register(successHandler,errorHandler,{senderID:CONFIG.PUSH.senderId,ecb:"onNotificationGCM"})}else{$("#app-status-ul").append("<li>registering iOS</li>");pushNotification.register(tokenHandler,errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"onNotificationAPN"})}CONFIG.PUSH.registered=true}catch(e){CONFIG.PUSH.registered=false;var t="There was an error on this page.\n\n";t+="Error description: "+e.message+"\n\n";alert(t)}}function onNotificationAPN(e){if(e.alert){$("#app-status-ul").empty().append("<li>push-notification: "+e.alert+"</li>");navigator.notification.alert(e.alert)}if(e.sound){var t=new Media(e.sound);t.play()}if(e.badge){pushNotification.setApplicationIconBadgeNumber(successHandler,e.badge)}}function onNotificationGCM(e){switch(e.event){case"registered":if(e.regid.length>0){$.post(CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"/register?regid="+e.regid).done(function(t,n,r){CONFIG.PUSH.regid=e.regid;CONFIG.PUSH.registered=true});console.log("regID = "+e.regid)}break;case"message":if(e.foreground){}else{if(e.coldstart){}else{}}$.event.trigger(""+e.payload.status,e.payload);fillPushNotifictionCard(e.payload.title,e.payload.message,e.payload.site);break;case"error":$("#app-status-ul").append("<li>ERROR -> MSG:"+e.msg+"</li>");break;default:$("#app-status-ul").append("<li>EVENT -> Unknown, an event was received and we do not know what it is</li>");break}}function unregisterDevice(){pushNotification.unregister(successUnregisterHandler,errorHandler)}function tokenHandler(e){$("#app-status-ul").append("<li>token: "+e+"</li>")}function successUnregisterHandler(e){$.ajax({url:CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"/delete"+"?regid="+CONFIG.PUSH.regid,type:"GET",success:function(e){CONFIG.PUSH.regid="";CONFIG.PUSH.registered=false},error:function(e,t,n){var r="("+e.responseText+")";alert(JSON.stringify(n))},complete:function(){unRegisterPushEvents();$("#app-status-ul").empty().append("<li>successfully unregistered device: "+e+"</li>")}})}function successHandler(e){$("#app-status-ul").empty().append("<li>successfully registered device: "+e+"</li>")}function errorHandler(e){$("#app-status-ul").empty().append("<li>error while connecting to pushNotificationService: "+e+"</li>")}function registerPushEvents(){for(var e in CONFIG.PUSH.STATUS){$.event.trigger({type:e});$(document).on(e,eventHandler.get(e))}}function unRegisterPushEvents(){for(var e in CONFIG.PUSH.STATUS){$(document).off(e)}}var pushNotification;var eventHandler=function(){var e={};var t={};t.set=function(t){return function(n){t&&(e[t]=n)}};t.get=function(t){return e[t]};return t}();eventHandler.set(1e3)(function(t,n){$.post(CONFIG.SERVER.base+CONFIG.SERVER.pushnotification+"?credentials="+CONFIG.AUTH.credentials+"&salt="+CONFIG.AUTH.salt+"&regid="+CONFIG.PUSH.regid).done(function(e,t,n){if(e!="true"){alert("failure")}})});eventHandler.set(4001)(function(t,n){});eventHandler.set(2e3)(function(t,n){})
