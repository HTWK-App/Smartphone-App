<div id="qis_page" data-role="page" data-dom-cache="true" data-title="QIS" data-theme="a" data-content-theme="a">
	<div data-role="content" class="toblur">
		<div id="qis_list" data-role="collapsible-set" data-content-theme="a"></div>
		<div data-role="popup" id="signInDialog" data-overlay-theme="b" data-theme="b" data-dismissible="false" style="max-width:400px;">
		    <div data-role="header" data-theme="a">
		   	 <h1>Einloggen</h1>
		    </div>
		    <div role="main" class="ui-content">
			<h3 class="ui-title">Sie sind noch nicht eingeloggt,  bitte loggen Sie sich jetzt ein!</h3>
			<label for="username"><strong>Nutzername:</strong></label>
			<input type="text" name="username" id="popupUsername" value="" placeholder="Nutzername">
			<label for="password"><strong>Passwort:</strong></label>
			<input type="password" name="password" id="popupPassword" value="" autocomplete="off" placeholder="******">
			<a id="popupAbort" href="#menu" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b">Abbrechen</a>
			<a id="popupSave" href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-transition="flow">Speichern</a>
		    </div>
		</div>
	</div>

	<script>
	
    	$( "#qis_page" )
    		.on("pagecreate", function () {if(GLOBAL.DEMO.username != "") initQISView();})
    		.on("pageshow", function() {
			$("#btn_refresh")
    				.off()
    				.on("click", initQISView);
			if(GLOBAL.DEMO.username == "") {
				$( "#signInDialog" ).popup( "open", { positionTo: "window", transition: "pop" } );
			}else{
				if(!GLOBAL.INIT.qis) loadingIn();	
			}
    		 });

		$("#popupSave")
		.on("click", function () {
			saveUsernamePassword($("#popupUsername").val(),$("#popupPassword").val());
			$( "#signInDialog" ).popup( "close");
			function wait() {
				if(GLOBAL.DEMO.checking == true){
					setTimeout(wait, 50);//wait 50 millisecnds then recheck
					return;
				}
				if(GLOBAL.DEMO.correct == false){
					$( "#signInDialog" ).popup( "open", { positionTo: "window", transition: "pop" } );
					return;
				}
				initQISView();
			}
			wait();
		});

		$("#popupAbort")
		.on("click", function () {
			$( "#signInDialog" ).popup( "close");
		});

		function initQISView() {
			loadingIn();
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.qis+'?credentials='+GLOBAL.DEMO.credentials+'&salt='+GLOBAL.DEMO.salt)
			 .done(function(data, status, jqXHR) {
				 fillQIS(data);
				 loadingOut();
				 GLOBAL.INIT.qis = true;
			  });
		};
		
		function fillQIS(data) {
			var sem, module;
			var divs = "";
			
			if(!isEmpty(data))
			{
				for(var k in data)
				{
					sem = data[k];
					
					divs += '<div id="sem'+sem.id+'" data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" '+
							'data-iconpos="right" data-mini="true" data-theme="a" data-content-theme="a"><h4>'+sem.description+'</h4>';
					
					if(!isEmpty(sem.modules))
					{
    					for(var l in sem.modules)
    					{
    						module = sem.modules[l];
    						
    						divs += '<p><b>Prüfungskennung:</b><br>'+module.id+'</p>'+
    								'<p><b>Prüfungstitel:</b><br>'+module.title+'</p>'+
    								'<p><b>Beschreibung:</b><br>'+module.description+'</p>'+
    								'<p><b>ECTS-Punkte:</b><br>'+module.ects+'</p>'+
    								'<p><b>Note:</b><br>'+module.mark+'</p><hr>';
    					}
					}
					else
					{
						divs += '<p>Keine Informationen verfügbar!</p>';
					}
					
					divs += '</div>';
				}
				
				$( "#qis_list" )
					.empty()
					.append(divs)
					.collapsibleset("refresh");
			}
		};
	</script>
</div>
