<div id="qis_page" data-role="page" data-dom-cache="true" data-title="QIS" data-theme="a" data-content-theme="a">
	<div data-role="content" class="toblur">
		<div id="qis_list" data-role="collapsible-set" data-content-theme="a"></div>
	</div>

	<script>
    	$( "#qis_page" )
    		.on("pagecreate", initQISView)
    		.on("pageshow", function() {
    			$("#btn_refresh")
    				.off()
    				.on("click", initQISView);
    			
    			if(isEmpty(CONFIG.AUTH.credentials)) {
    				openSignInDialog(initQISView);
    			} 
    			else {
    				if(!GLOBAL.INIT.qis) loadingIn();	
    			}
    		 });

		function initQISView() {
			if(!isEmpty(CONFIG.AUTH.credentials))
			{
				loadingIn();
				$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.qis+'?credentials='+CONFIG.AUTH.credentials+'&salt='+CONFIG.AUTH.salt)
				 .done(function(data, status, jqXHR) {
					 fillQIS(data);
					 GLOBAL.INIT.qis = true;
				  });
			}
		};
		
		function fillQIS(data) {
			var sem, module;
			var divs = "";
			
			if(!isEmpty(data))
			{
				for(var k in data)
				{
					sem = data[k];
					
					divs += '<div id="sem'+sem.id+'" data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" '+
							'data-iconpos="right" data-mini="true" data-theme="a" data-content-theme="a"><h4>'+sem.description+'</h4>';
					
					if(!isEmpty(sem.modules))
					{
    					for(var l in sem.modules)
    					{
    						module = sem.modules[l];
    						
    						divs += '<p><b>Prüfungskennung:</b><br>'+module.id+'</p>'+
    								'<p><b>Prüfungstitel:</b><br>'+module.title+'</p>'+
    								'<p><b>Beschreibung:</b><br>'+module.description+'</p>'+
    								'<p><b>ECTS-Punkte:</b><br>'+module.ects+'</p>'+
    								'<p><b>Note:</b><br>'+module.mark+'</p><hr>';
    					}
					}
					else
					{
						divs += '<p>Keine Informationen verfügbar!</p>';
					}
					
					divs += '</div>';
				}
				
				$( "#qis_list" )
					.empty()
					.append(divs)
					.collapsibleset("refresh");
			}
			
			loadingOut();
		};
	</script>
</div>