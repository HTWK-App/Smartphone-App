<div id="qis_page" data-role="page" data-dom-cache="true" data-theme='b'>
	<div data-role="panel" id="menue_qis" data-theme="a" data-display="push">
		<ul data-role="listview">
			<li data-role="list-divider">Hauptmenü</li>
			<li data-icon="fire"><a href="index.html" >Startseite</a></li>
			<li data-icon="fire"><a href="news.html" >News</a></li>
			<li data-icon="trophy"><a href="timetable.html" >Stundenplan</a></li>
			<li data-icon="trophy"><a href="canteen.html" >Mensa</a></li>
			<li data-icon="trophy"><a href="mail.html" >Postfach</a></li>
			<li data-icon="trophy"><a href="qis.html" >QIS</a></li>
			<li data-icon="trophy"><a href="sport.html" >Hochschulsport</a></li>
			
		</ul>
		<!--<div data-role="collapsible"><h4>Info-Center</h4> -->
		<ul data-role="listview">
			<li data-role="list-divider">Info-Center</li>
			<li data-icon="trophy"><a href="info_general.html" >Allgemein</a></li>
			<li data-icon="trophy"><a href="info_staff.html" >Mitarbeiter</a></li>
			<li data-icon="trophy"><a href="info_buildings.html" >Gebäudeplan</a></li>
			<li data-icon="trophy"><a href="info_wlan.html" >WLAN-Konfiguration</a></li>
		</ul>
		<!--</div> -->
		<ul data-role="listview">
			<li data-role="list-divider">Tools</li>
			<li data-icon="trophy"><a href="room_search.html" >Leeren Raum finden</a></li>
			
		</ul>
		<ul data-role="listview">
			<li data-role="list-divider">Einstellungen</li>
			<li data-icon="trophy"><a href="settings.html" >HTWK-App</a></li>
		</ul>
	</div>
	<div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme='b'>
		<a href="#menue_qis" data-role='button' role="button" data-iconpos='left' data-inline='true'><i class="icon-ellipsis-vertical"></i>&nbsp;</a>
		<h1>&nbsp;HTWK App</h1>
	</div>
	<div data-role="content">
		<div id="qis_list" data-role="collapsible-set" data-content-theme="b"></div>
	</div>

	<script>

		/*TODO
		 * Remove animation from cards
		 */
	    	$( "#qis_page" )
	    		.on("pagecreate", qisInitQISView)
	    		.on("pageshow", function() {
	    			$("#btn_refresh")
	    				.off()
	    				.on("click", qisInitQISView);
	    			
	    			if(isEmpty(CONFIG.AUTH.credentials)) {
	    				openSignInDialog(qisInitQISView);
	    			} else {
	    				if(!GLOBAL.INIT.qis) loadingIn();	
	    			}
	    		 });

		/**
		 * Fetches data from the Server to fill the qis view.
		 *
		 */
		function qisInitQISView() {
			if(!isEmpty(CONFIG.AUTH.credentials)) {

				loadingIn();

				$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.qis+'?credentials='+CONFIG.AUTH.credentials+'&salt='+CONFIG.AUTH.salt)
				 .done(function(data, status, jqXHR) {
					if(!isEmpty(data.message)){ajaxErrorHandler(data, status, jqXHR); return;}

					qisFillQIS(data);

					loadingOut();
					GLOBAL.INIT.qis = true;
				})
				.fail(ajaxErrorHandler);
			}
		}
		
		/**
		 * Fill qis collapsible widget
		 *
		 * @param JSON data
		 *
		 */
		function qisFillQIS(data) {

			var sem, module;
			var divs = "";
			
			if(!isEmpty(data)) {
				for(var k in data) {
					sem = data[k];
					
					divs += '<div id="sem'+sem.id+'" data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" '+
							'data-iconpos="right" data-theme="b" data-content-theme="b"><h4>'+sem.description+'</h4>';
					
					if(!isEmpty(sem.modules)) {
						divs += '<ul data-nativedroid-plugin="cards" class="nativeDroidCards">';
	    					for(var l in sem.modules) {
	    						module = sem.modules[l];
	    						
	    						divs += '<li data-cards-type="text" >'+'<div class="inset">'+
								'	<h1>'+module.title+'</h1><hr>'+
								'	<p>'+
								'		'+module.description+
								'		<br/><br/><b>ECTS-Punkte: </b>'+module.ects+
								'		<br/><b>Note: </b>'+module.mark+
								'	</p>'+
								'</li>';
	    					}
					} else {
						divs += '<ul data-nativedroid-plugin="cards" class="nativeDroidCards">'+
							'	<li data-cards-type="text" >'+'<div class="inset">'+
							'		<h1>Keine Informationen verfügbar!</h1>'+
							'	</li>'+
							'</ul>';
					}
					
					divs += '</ul></div>';
				}
				
				$( "#qis_list" )
					.empty()
					.append(divs)
					.collapsibleset("refresh");
			}
		}
	</script>
</div>
