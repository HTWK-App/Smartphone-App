<div id="qis_page" data-role="page" data-dom-cache="true" data-title="QIS" data-theme="a" data-content-theme="a">
	<div data-role="content" class="toblur">
		<div id="qis_list" data-role="collapsible-set" data-content-theme="a"></div>
	</div>

	<script>
		/*$( document )
			.on("pagecreate", "#qis", initQISView)
			.on("pageshow", "#qis", function() {
				loadingIn();
				$("#qispage").detach();
			 });*/
		/*function() {
			$( "#qis-set" ).empty();
			fillQis();
		});*/
	
    	$( "#qis_page" )
    		.on("pagecreate", initQISView)
    		.on("pageshow", function() {
    			if(!GLOBAL.INIT.qis) loadingIn();
    			$("#btn_refresh")
    				.off()
    				.on("click", initQISView);
    		 });

		function initQISView() {
			loadingIn();
			$.getJSON(CONFIG.SERVER.base+CONFIG.SERVER.qis+'?credentials='+GLOBAL.DEMO.credentials+'&salt='+GLOBAL.DEMO.salt)
			 .done(function(data, status, jqXHR) {
				 fillQIS(data);
				 loadingOut();
				 GLOBAL.INIT.qis = true;
			  });
			
			/*$.getJSON(SERVER_URL+'qis/get?credentials='+CREDENTIALS+'&salt='+SALT).done( function(data, a, b) {
				$.each(data, function(key, item) {
					var grades = new Array();
					var descs = new Array();
					var ids = new Array();
					var ects = new Array();
					var titles = new Array();
					var i = 0;
					
					$.each(item.modules, function(m_key, m_item) {
						grades[i] = m_item.mark;
						descs[i] = m_item.description;
						ids[i] = m_item.id;
						ects[i] = m_item.ects;
						titles[i] = m_item.title;
						i++;
					});
					createSemester(item.id, item.description, ids, descs, ects, grades,titles);
				});
				$.mobile.loading('hide'); 
				showLoading = false;
			});*/
		};
		
		function fillQIS(data) {
			var sem, module;
			var divs = "";
			
			if(!isEmpty(data))
			{
				for(var k in data)
				{
					sem = data[k];
					
					divs += '<div id="sem'+sem.id+'" data-role="collapsible" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" '+
							'data-iconpos="right" data-mini="true" data-theme="a" data-content-theme="a"><h4>'+sem.description+'</h4>';
					
					if(!isEmpty(sem.modules))
					{
    					for(var l in sem.modules)
    					{
    						module = sem.modules[l];
    						
    						divs += '<p><b>Prüfungskennung:</b><br>'+module.id+'</p>'+
    								'<p><b>Prüfungstitel:</b><br>'+module.title+'</p>'+
    								'<p><b>Beschreibung:</b><br>'+module.description+'</p>'+
    								'<p><b>ECTS-Punkte:</b><br>'+module.ects+'</p>'+
    								'<p><b>Note:</b><br>'+module.mark+'</p><hr>';
    					}
					}
					else
					{
						divs += '<p>Keine Informationen verfügbar!</p>';
					}
					
					divs += '</div>';
				}
				
				$( "#qis_list" )
					.empty()
					.append(divs)
					.collapsibleset("refresh");
			}
		};
		
		/*function createSemester(id,semName,ids,descs,ects,grades,titles){
			var con = $( "#qis-set" );
			var pattern =
					'<div data-role="collapsible" data-theme="a" data-content-theme="a" '+
					'data-collapsed-icon="carat-d" data-expanded-icon="carat-u" '+
					'data-iconpos="right" data-mini="true" id="sem'+id+'"><h4>'+semName+'</h4>';
			for (var i in ids) {
				pattern = pattern +
					'<p><b>Prüfungskennung:</b><br>'+ids[i]+'</p>'+
					'<p><b>Prüfungstitel:</b><br>'+titles[i]+'</p>'+
					'<p><b>Beschreibung:</b><br>'+descs[i]+'</p>'+
					'<p><b>ECTS-Punkte:</b><br>'+ects[i]+'</p>'+
					'<p><b>Note:</b><br>'+grades[i]+'</p><hr>';
			}
			pattern = pattern + '</div>';
			con.append(pattern).collapsibleset("refresh");
		}*/
	</script>
</div>